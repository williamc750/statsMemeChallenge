---
title: "Selection Bias & Missing Data Challenge - Part 2"
subtitle: "Creating a Statistics Meme: Visualizing Selection Bias"
format:
  html: default
execute:
  echo: true
  eval: true
---


<style>
/* Hide code cells and their outputs */
.cell,
.cell-output,
pre code {
  display: none !important;
}
</style>


# ðŸŽ¨ Selection Bias & Missing Data Challenge - Part 2




```{python}
#| label: load-images
#| echo: false
#| eval: true


import numpy as np
from PIL import Image
import matplotlib.pyplot as plt


# Load original image
original_img = Image.open('OrigImage.jpg')
if original_img.mode != 'L':
    original_img = original_img.convert('L')
original_array = np.array(original_img, dtype=np.float32) / 255.0


# Load stippled image (from Part 1 - see https://flyaflya.github.io/stippleChallenge/)
stipple_array = np.load('stippled_image.npy')


# Display the original image
import matplotlib
matplotlib.use('Agg')  # Use non-interactive backend
plt.figure(figsize=(8, 8))
plt.imshow(original_array, cmap='gray', vmin=0, vmax=1)
plt.title("Original Image (Reality)", fontsize=14)
plt.axis('off')
plt.tight_layout()
plt.savefig('original_image_preview.png', dpi=150, bbox_inches='tight')
plt.close()


print(f"Original: {original_array.shape}, Stipple: {stipple_array.shape}")
```






```{python}
#| label: create-s-letter
#| echo: false
#| eval: true


from PIL import Image, ImageDraw, ImageFont
import numpy as np
import matplotlib
matplotlib.use('Agg')  # Use non-interactive backend to avoid Tcl/Tk issues
import matplotlib.pyplot as plt
import os


# Get dimensions from stippled image
height, width = stipple_array.shape


# Create a white background image
s_img = Image.new('L', (width, height), color=255)  # 'L' mode = grayscale, 255 = white
draw = ImageDraw.Draw(s_img)


# Try to use a bold font, fallback to default if not available
font = None
font_size = int(height * 0.85)


# Try common font paths
font_paths = [
    "C:/Windows/Fonts/arialbd.ttf",  # Windows Arial Bold
    "C:/Windows/Fonts/ARIALBD.TTF",  # Windows Arial Bold (uppercase)
    "/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf",  # Linux
    "/System/Library/Fonts/Supplemental/Arial Bold.ttf",  # macOS
    "arialbd.ttf",  # Current directory
    "DejaVuSans-Bold.ttf"  # Current directory
]


for font_path in font_paths:
    try:
        if os.path.exists(font_path):
            font = ImageFont.truetype(font_path, size=font_size)
            break
    except:
        continue


# If no font found, try to load default and make it larger
if font is None:
    try:
        font = ImageFont.load_default()
        # Default font is small, so we'll need to scale it
    except:
        font = None


# Get text bounding box to center it
text = "S"
bbox = draw.textbbox((0, 0), text, font=font)
text_width = bbox[2] - bbox[0]
text_height = bbox[3] - bbox[1]


# Calculate position to center the text
x = (width - text_width) // 2 - bbox[0]
y = (height - text_height) // 2 - bbox[1]


# Draw the "S" in black (0 = black in grayscale)
draw.text((x, y), text, fill=0, font=font)


# Convert to numpy array and normalize to [0, 1] range
# 0.0 = black, 1.0 = white
s_array = np.array(s_img, dtype=np.float32) / 255.0


# Display the "S" image
plt.figure(figsize=(8, 8))
plt.imshow(s_array, cmap='gray', vmin=0, vmax=1)
plt.title("Selection Bias Pattern (Letter 'S')", fontsize=14)
plt.axis('off')
plt.tight_layout()


# Save the image to a file (works without Tcl/Tk)
plt.savefig('s_letter_preview.png', dpi=150, bbox_inches='tight')
plt.close()  # Close the figure to free memory
print("âœ“ S letter image saved as 's_letter_preview.png'")
print("  Open this file to view the image.")


print(f"S matrix shape: {s_array.shape}")
print(f"S matrix range: [{s_array.min():.3f}, {s_array.max():.3f}]")
```




```{python}
#| label: create-masked-estimate
#| echo: false
#| eval: true


# Create a binary mask: where "S" is black (pixels < 0.5), that's where data is missing
threshold = 0.5
s_mask = s_array < threshold  # True where "S" is black (missing data)


# Apply the mask to the stippled image
# Where the "S" is black (mask is True), set pixels to white (1.0) - removing the stipple points
# Where the "S" is white (mask is False), keep the original stipple values
masked_estimate = np.where(s_mask, 1.0, stipple_array)


# Display the masked estimate
plt.figure(figsize=(8, 8))
plt.imshow(masked_estimate, cmap='gray', vmin=0, vmax=1)
plt.title("Masked Estimate (Stippled Image with Selection Bias)", fontsize=14)
plt.axis('off')
plt.tight_layout()


# Save the image
plt.savefig('masked_estimate_preview.png', dpi=150, bbox_inches='tight')
plt.close()
print("âœ“ Masked estimate saved as 'masked_estimate_preview.png'")
print(f"Masked estimate shape: {masked_estimate.shape}")
print(f"Masked estimate range: [{masked_estimate.min():.3f}, {masked_estimate.max():.3f}]")
print(f"Number of pixels removed (set to white): {np.sum(s_mask)}")
```




```{python}
#| label: create-four-panel-meme
#| echo: false
#| eval: true


# Create a 1Ã—4 layout for the four panels
fig, axes = plt.subplots(1, 4, figsize=(16, 4))
fig.patch.set_facecolor('#FFE5E5')  # Light pink background


# Panel 1: Reality (original image)
axes[0].imshow(original_array, cmap='gray', vmin=0, vmax=1)
axes[0].set_title('Reality', fontsize=14, fontweight='bold', pad=10)
axes[0].axis('off')


# Panel 2: Your Model (stippled image)
axes[1].imshow(stipple_array, cmap='gray', vmin=0, vmax=1)
axes[1].set_title('Your Model', fontsize=14, fontweight='bold', pad=10)
axes[1].axis('off')


# Panel 3: Selection Bias (the "S" letter)
axes[2].imshow(s_array, cmap='gray', vmin=0, vmax=1)
axes[2].set_title('Selection Bias', fontsize=14, fontweight='bold', pad=10)
axes[2].axis('off')


# Panel 4: Estimate (masked stippled image)
axes[3].imshow(masked_estimate, cmap='gray', vmin=0, vmax=1)
axes[3].set_title('Estimate', fontsize=14, fontweight='bold', pad=10)
axes[3].axis('off')


# Minimize spacing between panels
plt.tight_layout(pad=0.5)
plt.subplots_adjust(wspace=0, hspace=0)


# Save the meme with high DPI
plt.savefig('statistics_meme.png', dpi=200, bbox_inches='tight', facecolor='#FFE5E5')
plt.close()
print("âœ“ Four-panel meme saved as 'statistics_meme.png'")
```


### Final Meme


![Four-Panel Statistics Meme: Reality, Your Model, Selection Bias, and Estimate](statistics_meme.png)


### Selection Bias Explained


Selection bias occurs when the data is not representative of the population of interest. In the case of the statistics meme, the data is not representative of the population of interest because the "S" letter is not present in the original image. The "S" letter is the selection bias pattern and, as a result, it is replacing original data from the original image. Our meme demonstrates selection bias because the final image or "estimate" is far away from the original image. This meme serves as a reminder that we need to be careful about how we collect and analyze data, and that we need to be aware of selection bias.


